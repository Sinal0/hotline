<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>داشبورد خریدار - Hotline</title>
    <!-- Bootstrap RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/styles.css">
    <!-- Theme Initialization - Must load before body renders -->
    <script src="../js/theme-init.js"></script>
</head>
<body>
    <!-- Navigation Container -->
    <div id="navbar-container"></div>

    <!-- Dashboard -->
    <section class="py-5">
        <div class="container">
            <div class="card shadow-sm mb-4">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="mb-2">داشبورد خریدار</h1>
                        <p class="text-muted mb-0" id="buyerName">خوش آمدید</p>
                    </div>
                    <button class="btn btn-outline-danger" onclick="handleLogout()">
                        <i class="fas fa-sign-out-alt me-2"></i>خروج از حساب کاربری
                    </button>
                </div>
            </div>

            <ul class="nav nav-tabs mb-4" id="dashboardTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="orders-tab-btn" data-bs-toggle="tab" data-bs-target="#orders" type="button" role="tab">سفارشات من</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="favorites-tab-btn" data-bs-toggle="tab" data-bs-target="#favorites" type="button" role="tab">علاقه‌مندی‌ها</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="profile-tab-btn" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab">پروفایل</button>
                </li>
            </ul>

            <div class="tab-content" id="dashboardTabContent">
                <!-- Orders Tab -->
                <div class="tab-pane fade show active" id="orders" role="tabpanel">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h2 class="mb-4">سفارشات من</h2>
                            <div id="buyerOrders">
                                <div class="text-center py-5">
                                    <i class="fas fa-shopping-bag text-muted mb-3" style="font-size: 4rem;"></i>
                                    <p class="text-muted">هنوز سفارشی ثبت نکرده‌اید</p>
                                    <a href="products.html" class="btn btn-primary mt-3">مشاهده محصولات</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Favorites Tab -->
                <div class="tab-pane fade" id="favorites" role="tabpanel">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h2 class="mb-4">علاقه‌مندی‌ها</h2>
                            <div id="favoritesList">
                                <div class="text-center py-5">
                                    <i class="fas fa-heart text-muted mb-3" style="font-size: 4rem;"></i>
                                    <p class="text-muted">لیست علاقه‌مندی‌های شما خالی است</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Tab -->
                <div class="tab-pane fade" id="profile" role="tabpanel">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h2 class="mb-4">اطلاعات پروفایل</h2>
                            <form id="profileForm" onsubmit="updateProfile(event)">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">نام شرکت / فروشگاه</label>
                                        <input type="text" class="form-control" id="profileName" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">ایمیل</label>
                                        <input type="email" class="form-control" id="profileEmail" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">شماره تماس</label>
                                        <input type="tel" class="form-control" id="profilePhone" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">کد پستی</label>
                                        <input type="text" class="form-control" id="profilePostalCode">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">آدرس</label>
                                        <textarea class="form-control" id="profileAddress" rows="3"></textarea>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary mt-4">ذخیره تغییرات</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white py-5 mt-5">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <h5>Hotline</h5>
                    <p class="text-muted">پلتفرم پیشرو در خرید و فروش عمده</p>
                </div>
                <div class="col-md-6 col-lg-3">
                    <h5>لینک‌های مفید</h5>
                    <ul class="list-unstyled">
                        <li><a href="about.html" class="text-muted text-decoration-none">درباره ما</a></li>
                        <li><a href="contact.html" class="text-muted text-decoration-none">تماس با ما</a></li>
                        <li><a href="terms.html" class="text-muted text-decoration-none">قوانین و مقررات</a></li>
                    </ul>
                </div>
                <div class="col-md-6 col-lg-3">
                    <h5>پشتیبانی</h5>
                    <ul class="list-unstyled">
                        <li><a href="faq.html" class="text-muted text-decoration-none">سوالات متداول</a></li>
                        <li><a href="support.html" class="text-muted text-decoration-none">پشتیبانی</a></li>
                    </ul>
                </div>
                <div class="col-md-6 col-lg-3">
                    <h5>تماس با ما</h5>
                    <p class="text-muted"><i class="fas fa-phone me-2"></i> 021-12345678</p>
                    <p class="text-muted"><i class="fas fa-envelope me-2"></i> info@b2bmarketplace.com</p>
                </div>
            </div>
            <hr class="my-4 bg-secondary">
            <div class="text-center text-muted">
                <p class="mb-0">&copy; 2024 Hotline. تمامی حقوق محفوظ است.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Load Navbar -->
    <script src="../js/loadNavbar.js"></script>
    <!-- Custom JS -->
    <script src="../js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            checkBuyerAuth();
            loadProfile();
            initializeCart();
        });

        function checkBuyerAuth() {
            const userStr = localStorage.getItem('currentUser');
            if (!userStr) {
                window.location.href = '/index.html';
                return;
            }
            try {
                const user = JSON.parse(userStr);
                if (user.role !== 'buyer') {
                    window.location.href = '/index.html';
                    return;
                }
                document.getElementById('buyerName').textContent = `خوش آمدید ${user.name}`;
            } catch (error) {
                console.error('Error parsing user data:', error);
                window.location.href = '/index.html';
            }
        }

        function switchDashboardTab(tab) {
            const tabBtn = document.getElementById(`${tab}-tab-btn`);
            if (tabBtn) {
                const tabInstance = new bootstrap.Tab(tabBtn);
                tabInstance.show();
            }
        }

        function loadProfile() {
            const userStr = localStorage.getItem('currentUser');
            if (userStr) {
                try {
                    const user = JSON.parse(userStr);
                    document.getElementById('profileName').value = user.name || '';
                    document.getElementById('profileEmail').value = user.email || '';
                    document.getElementById('profilePhone').value = user.phone || '';
                    document.getElementById('profileAddress').value = user.address || '';
                    document.getElementById('profilePostalCode').value = user.postalCode || '';
                } catch (error) {
                    console.error('Error loading profile:', error);
                }
            }
        }

        function updateProfile(event) {
            event.preventDefault();
            const userStr = localStorage.getItem('currentUser');
            if (!userStr) {
                window.location.href = '/index.html';
                return;
            }
            
            try {
                const user = JSON.parse(userStr);
                user.name = document.getElementById('profileName').value;
                user.email = document.getElementById('profileEmail').value;
                user.phone = document.getElementById('profilePhone').value;
                user.address = document.getElementById('profileAddress').value;
                user.postalCode = document.getElementById('profilePostalCode').value;

                localStorage.setItem('currentUser', JSON.stringify(user));
                if (typeof showNotification === 'function') {
                    showNotification('پروفایل با موفقیت به‌روزرسانی شد');
                } else {
                    alert('پروفایل با موفقیت به‌روزرسانی شد');
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                alert('خطا در به‌روزرسانی پروفایل');
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = '/index.html';
        }
    </script>
</body>
</html>
